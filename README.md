# 포즈인식을 이용한 넘어짐 감지 서비스   

    팀명 : KDK 
  
    결과물 브랜드명 : 넘어지지마요
  
  
# 프로젝트 개요

  <img src="https://user-images.githubusercontent.com/21076531/85230991-a6e8ee80-b42e-11ea-9903-138f32ecd3a0.jpg" alt="posenet"></img>

  넘어지는 것은 위험합니다. 65세 이상 인구의 3분의 1이상이 연간 한 번 이상 낙상을 경험합니다.

  우리나라의 경우 65세 이상 노인의 신체 손상 중 반 이상의 원인이 낙상입니다. 노인들의 사망 사고는 넘어지는 데에서 시작되는 경우가 많습니다.

  사망원인은 뇌출혈 등 머리손상이 40.3%, 엉덩이 및 넓적다리 손상이 23.3%, 허리뼈 또는 골반 손상이 10.9% 입니다. 빠르고 적절한 응급처치를 받으면 생존율이 크게 높아지는 원인들입니다.

  <img src="https://user-images.githubusercontent.com/21076531/85231039-07782b80-b42f-11ea-9f43-cf2f25ce3597.jpg" alt="posenet"></img>

  또한 단순 낙상이 아닌 고혈압, 심혈관 질환, 기립성 저혈압, 뇌질환으로 인한 기절, 쓰러짐은 더욱 심각합니다. 심혈관 질환의 경우 5분내에 응급처치를 하지 않으면 뇌손상이 시작되어 사망에 이르게 됩니다. 
  
  부상자가 정신을 잃었거나 적절한 통신수단에 접근할 수 없는 상태가 된다면, 환자들이 적절한 응급처치를 받을 수 없게 됩니다.
  
  이러한 상황에서 '넘어지지마요'는 넘어짐을 감지하여 비상 연락망에 연락을 취해 빠르게 응급처치를 받을 수 있도록 도와줍니다.
 

# 프로젝트 상세

- 카메라를 통해 사람의 포즈를 인식하고, 포즈의 변화와 움직임을 감지합니다.

- 화면상의 인물의 포즈 데이터를 기준으로 쓰러지거나, 넘어지는 상황을 인지하여 위험상황을 판별합니다.

- 머리의 위치가 갑작스럽게 변하거나, 다리를 중심으로 회전하는 경우를 넘어짐, 쓰러짐으로 감지하여 서버에 전송하면 SMS로 비상연락망과 119에 연락하도록 하는 시스템을 구현합니다.

- 텐서플로우에서 오픈소스로 공개한 포즈인식 모델 PoseNet을 사용하여 포즈 인식을 수행합니다. 

- 포즈 데이터에 따른 실제 포즈를 라벨링한 데이터를 모아 분류 모델을 학습하면, 포즈 데이터만으로 영상, 사진 속 인물이 어떤 자세를 취하고 있는지를 판별할 수 있게됩니다.

- 더 많은 포즈 데이터가 모일수록, 더 정확한 포즈 인식과 넘어짐 이외의 다양한 상황을 인식할 수 있게됩니다.

- 포즈 인식이 클라이언트에서 이루어지므로 어느정도 컴퓨팅 파워가 필요하므로, 안드로이드 머신을 사용할 계획입니다. 라즈베리파이로도 구현 가능합니다.

# 시스템 구성도
![cd1](https://user-images.githubusercontent.com/21076531/80339700-2e383c80-889a-11ea-8135-968f9980e00b.png)


# 기술 상세

<img src="https://user-images.githubusercontent.com/21076531/85230465-460be700-b42b-11ea-84e2-c50e8de1c129.gif" alt="posenet"></img>
- 텐서플로우에서 오픈소스로 공개한 포즈인식 모델 PoseNet을 사용하여 포즈 인식을 수행합니다. 

<img src="https://user-images.githubusercontent.com/21076531/85230599-39d45980-b42c-11ea-9c7c-e97411aed450.png" alt="posenet-overview"></img>
<img src="https://user-images.githubusercontent.com/21076531/85230600-3b058680-b42c-11ea-9d8b-26464a57036a.png" alt="posenet-detail"></img>
- PoseNet은 현재 영상에서 전처리를 거친 후, CNN Network을 이용하여 17개의 필터로 인물의 각 관절부위의 위치가 존재할 확률을 저장하는 히트맵과 더 가능성이 높은 방향을 추론하기 위한 오프셋 벡터를 산출해냅니다. 그 후 히트맵은 각 확률에 대해 시그모이드 활성화 함수를 거쳐, 히트맵의 값이 가장 큰 위치, 즉 관절이 존재할 확률이 가장 높은 이미지의 좌표를 산출해냅니다. 이 좌표를 오프셋 벡터의 정보와 종합하여 각 관절의 위치를 표시합니다.

- 포즈 인식을 통해 인식된 인물의 포즈 데이터를 json형식의 http 통신을 통해 서버에 전송하도록 할 것입니다. 전송된 데이터는 AWS DynamoDB NoSql에 전송된 각 관절 이름을 Key로, 위치를 Value로 가지는 json 형식으로 저장 될 예정입니다.

- 서버는 AWS Lambda를 이용한 Serverless 아키텍쳐로 구성할 예정이며, 파이썬을 이용한 AWS SDK를 사용합니다. 포즈 데이터를 저장하는 API와 비상연락망에 연락하는 API 두개를 개발하였습니다.

- 분석된 결과를 가지고 해당 카메라 위치에 넘어진 사람이 있음을 감지하여 미리 지정된 비상연락망에 연락합니다. 비상 연락망 연락 수단으로는 여러가지가 고려되었지만, 119에 비상연락 할 수있고 모두가 이용가능한 SMS문자 알림만 만들었습니다.



# 기대성과
  
- 요양원, 인적이 드문 길, 기저질환 환자의 집 등에서 일반적인 CCTV를 사용하여 감시 할 때보다 더욱더 효과적으로 비상상황을 대처할 수 있습니다.

- 노인이나 거동이 불편한 사람들이 인적이 드문 곳에서 미끄러지거나 넘어져서 주위에 알리기 어려운 상황을 해결할 수 있습니다.

- 스마트시티 시스템에 적용되어 비상환자를 빠르게 발견 할 수 있습니다.

  
  
# Teammates
  
  강동욱
  
    역할 : 서버 개발, 커미터
  
    핵심기여역량 : 서버 비상연락망 연락 SMS 구현, DB 연동, 커미터, 정보과학회 논문 작성, 앱 셋팅 구현

  <img src="https://user-images.githubusercontent.com/21076531/79041137-508a5300-7c28-11ea-9024-f9688c5ca3b4.jpg" width="256px" height="256px" title="강동욱" alt="강동욱"></img>
    
  오새암
  
    역할 : 머신러닝 모델 개발
    
    핵심기여역량 : 카메라인식 포즈인식(머신러닝) 모델 적용, 넘어짐 감지 알고리즘 개발
    
   <img src="https://user-images.githubusercontent.com/50190325/79058904-92f67300-7cae-11ea-8831-89778d5b0ab4.jpg" width="120px" height="160px" title="오새암" alt="오새암"></img>
    
  천명철
  
    역할 : 팀장, 클라이언트 개발
    
    핵심기여역량 : 앱 개발, 팀장, 온라인 미팅 주도, 최종 발표, 프로젝트 판넬 제작
   
  <img src="https://user-images.githubusercontent.com/50235391/79042795-aadde080-7c35-11ea-808c-2b4d18932ca3.jpg" width="110px" height="150px" title="천명철" alt="ME"></img>
    
    


# 개발환경


  개발 도구 : Tensorflow-Poseestimation, Android Studio(Kotlin), Git, PyCharm(Python)
  
  협업 도구 : github, Slack, Trello
  
  개발 방식 : github을 이용한 pull request 방식으로 agile 개발.  Trello를 이용한 프로젝트 관리. 
